name: Claude Issue Root Cause Analysis

on:
  issues:
    types: [opened]

jobs:
  analyze-issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write # Issueã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãè¾¼ã‚€ãŸã‚ã«å¿…è¦ãªæ¨©é™
      contents: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Claude Issue Analysis
        id: claude-analysis # å¾Œç¶šã®ã‚¹ãƒ†ãƒƒãƒ—ã§çµæœã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«IDã‚’ä»˜ä¸
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          # model: "claude-3-opus-20240229" # ã‚ˆã‚Šé«˜åº¦ãªåˆ†æãŒå¿…è¦ãªå ´åˆã¯Opusã‚’æ¨å¥¨

          # Issueåˆ†æã¨æ·±æ˜ã‚Šã‚’æŒ‡ç¤ºã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
          direct_prompt: |
            ä»¥ä¸‹ã®Issueã®ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚
            ç›®çš„ã¯ã€å ±å‘Šã•ã‚Œã¦ã„ã‚‹è¡¨é¢çš„ãªå•é¡Œã‹ã‚‰ã€ãã®èƒŒå¾Œã«ã‚ã‚‹ã€ŒçœŸã®æ ¹æœ¬åŸå› ã€ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã§ã™ã€‚

            **åˆ†ææ‰‹æ³•:**
            ã€Œãªãœãªãœåˆ†æï¼ˆ5 Whysï¼‰ã€ã®ã‚ˆã†ãªæ‰‹æ³•ã‚’æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã«ç”¨ã„ã¦ã€å•é¡Œã‚’æ®µéšçš„ã«æ·±æ˜ã‚Šã—ã¦ãã ã•ã„ã€‚
            ã€Œãªãœã“ã®å•é¡ŒãŒèµ·ããŸã®ã‹ï¼Ÿã€ã¨ã„ã†å•ã„ã‚’ç¹°ã‚Šè¿”ã—ã€æŠ½è±¡çš„ã¾ãŸã¯è¡¨é¢çš„ãªåŸå› ã‹ã‚‰ã€ã‚ˆã‚Šå…·ä½“çš„ã§æ ¹æœ¬çš„ãªåŸå› ã¸ã¨æ˜ã‚Šä¸‹ã’ã¦ãã ã•ã„ã€‚

            **å‡ºåŠ›å½¢å¼:**
            æœ€çµ‚çš„ãªåˆ†æçµæœã‚’ã€ä»¥ä¸‹ã®æ§‹é€ ã§åˆ†ã‹ã‚Šã‚„ã™ãã¾ã¨ã‚ã¦ãã ã•ã„ã€‚
            1. **å ±å‘Šã•ã‚ŒãŸå•é¡Œã®è¦ç´„:**
            2. **æ ¹æœ¬åŸå› åˆ†æã®éç¨‹ï¼ˆæ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ï¼‰:**
            3. **ç‰¹å®šã•ã‚ŒãŸæ ¹æœ¬åŸå› :**
            4. **æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**

            ---
            **Issue Title:** ${{ github.event.issue.title }}
            **Issue Body:**
            ${{ github.event.issue.body }}

      - name: Post analysis as a comment
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ¤– **Claudeã«ã‚ˆã‚‹Issueã®æ ¹æœ¬åŸå› åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚**

            ---
            ${{ steps.claude-analysis.outputs.review_body }}